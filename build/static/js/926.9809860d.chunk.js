"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[926],{926:function(e,n,t){t.r(n),t.d(n,{default:function(){return k}});var r=t(4165),s=t(5861),c=t(885),i=t(2791),o=t(2966),u=t(5223),a=t(8735),p=t(3046),l=t(5154),d=t(2504),x=t(5272),f=t(32),h=t(9731),m=t(4490),j=t(5764),g=t(184);var y=function(e){var n=e.isOpen,t=e.onClose,o=(e.userId,e.basket,e.price),u=e.cb,p=(0,j.useElements)(),l=(0,j.useStripe)(),x=(0,i.useState)(null),f=(0,c.Z)(x,2),y=f[0],v=f[1];function k(){return(k=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("https://cdn.jsdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies/uah.json").then((function(e){return e.json()})).then((function(e){return v(e.uah.usd)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=(0,s.Z)((0,r.Z)().mark((function e(){var n,s,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l&&p){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,l.createPaymentMethod({type:"card",card:p.getElement(j.CardElement)});case 4:return n=e.sent,e.next=7,h.Z.post("/stripe",{price:Math.round(o*y*100)/100}).then((function(e){return{secret:e.data.client_secret,id:e.data.intent_id}}),(function(e){return console.log(e),e}));case 7:return s=e.sent,e.next=10,l.confirmCardPayment(s.secret,{payment_method:n.paymentMethod.id});case 10:if(!(c=e.sent).error){e.next=14;break}return console.log(c.error),e.abrupt("return");case 14:if("succeeded"!==c.paymentIntent.status){e.next=20;break}return e.next=17,h.Z.post("/confirm-payment",{payment_id:s.id,payment_type:"stripe"}).then((function(e){return e.data.success}),(function(e){return console.log(e),e}));case 17:e.sent,u(),t();case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,i.useEffect)((function(){!function(){k.apply(this,arguments)}()}),[]),(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(m.u_,{isOpen:n,onClose:t,children:[(0,g.jsx)(m.ZA,{}),(0,g.jsxs)(m.hz,{children:[(0,g.jsx)(m.xB,{children:(0,g.jsx)(a.xv,{w:"100%",textAlign:"center",fontSize:"30px",children:"\u041e\u043f\u043b\u0430\u0442\u0430"})}),(0,g.jsx)(m.fe,{children:(0,g.jsx)(j.CardElement,{style:{fontSize:"30px"}})}),(0,g.jsxs)(m.mz,{display:"flex",justifyContent:"space-between",children:[(0,g.jsxs)(a.xv,{fontSize:"25px",children:[Math.round(o*y*100)/100,"$"]}),(0,g.jsxs)(a.kC,{alignItems:"center",children:[(0,g.jsx)(d.zx,{colorScheme:"blue",mr:3,onClick:function(){return C.apply(this,arguments)},children:"\u041f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438"}),(0,g.jsx)(d.zx,{onClick:t,children:"\u0421\u043a\u0430\u0441\u0443\u0432\u0430\u0442\u0438"})]})]})]})]})})},v=(0,f.Pi)((function(){var e=(0,i.useContext)(o._).user,n=(0,i.useState)([]),t=(0,c.Z)(n,2),f=t[0],m=t[1],j=(0,i.useState)(0),v=(0,c.Z)(j,2),k=v[0],C=v[1],b=(0,u.qY)(),Z=b.isOpen,w=b.onOpen,S=b.onClose;function z(){return(z=(0,s.Z)((0,r.Z)().mark((function e(){var n,t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.Z.get("basket/get");case 2:200===(n=e.sent).status&&(m(n.data),t=n.data.reduce((function(e,n){var t;return e+(null!==(t=n.priceWithDiscount)&&void 0!==t?t:n.price)*n.count}),0),C(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=(0,s.Z)((0,r.Z)().mark((function e(n){var t,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.id,s=n.itemPrice,e.next=3,h.Z.delete("basket/".concat(t));case 3:200===e.sent.status&&(m(f.filter((function(e){return e.id!==t}))),C(k-s));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=(0,s.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,h.Z.post("user/createOrder",{userId:e.user.id,basket:f,price:k});case 2:200===n.sent.status&&(m([]),C(0));case 4:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return(0,i.useEffect)((function(){!function(){z.apply(this,arguments)}()}),[]),(0,g.jsxs)(a.W2,{maxWidth:1080,paddingBottom:"200px",children:[f.length?(0,g.jsxs)(a.gC,{children:[f.map((function(e,n){var t;return(0,g.jsxs)(a.kC,{w:"100%",h:"150px",rounded:10,bg:"gray.100",m:4,p:"15px 20px 15px 20px",justifyContent:"space-between",children:[(0,g.jsxs)(a.kC,{children:[(0,g.jsx)(p.Ee,{h:"100%",w:"auto",rounded:5,src:e.image}),(0,g.jsxs)(a.kC,{mx:4,my:1,flexDirection:"column",justifyContent:"space-between",children:[(0,g.jsx)(a.xv,{fontSize:"30px",color:"gray.800",lineHeight:"30px",children:e.name}),(0,g.jsxs)(l.Y2,{defaultValue:e.count,min:1,w:"100px",bg:"gray.100",rounded:2,onChange:function(n){e.count=n,function(){var e=f.reduce((function(e,n){var t;return e+(null!==(t=n.priceWithDiscount)&&void 0!==t?t:n.price)*n.count}),0);C(e)}()},children:[(0,g.jsx)(l.zu,{}),(0,g.jsxs)(l.Fi,{children:[(0,g.jsx)(l.WQ,{}),(0,g.jsx)(l.Y_,{})]})]})]})]}),(0,g.jsxs)(a.kC,{flexDir:"column",justifyContent:"space-between",alignItems:"flex-end",children:[(0,g.jsx)(d.zx,{w:"40px",h:"40px",colorScheme:"red",onClick:function(){var n;return function(e){return I.apply(this,arguments)}({id:e.id,itemPrice:(null!==(n=e.priceWithDiscount)&&void 0!==n?n:e.price)*e.count})},children:(0,g.jsx)(x.pJ,{})}),(0,g.jsxs)(a.xv,{mx:4,fontSize:"30px",m:"0",color:"gray.600",children:[null!==(t=e.priceWithDiscount)&&void 0!==t?t:e.price,"\u20b4"]})]})]},n)})),(0,g.jsxs)(a.kC,{alignItems:"center",alignSelf:"end",borderWidth:"2px",borderColor:"green.300",rounded:5,bg:"green.100",p:"20px",children:[(0,g.jsxs)(a.xv,{fontSize:"30px",marginRight:"30px",color:"gray.600",children:[k,"\u20b4"]}),(0,g.jsx)(d.zx,{colorScheme:"green",onClick:w,children:"\u041a\u0443\u043f\u0438\u0442\u0438"})]})]}):(0,g.jsx)(a.xu,{position:"absolute",top:"calc(50% - 84px)",left:"calc(50% - 30px)",children:(0,g.jsx)(a.xv,{fontSize:"40px",children:"\u041f\u0443\u0441\u0442\u043e"})}),(0,g.jsx)(y,{isOpen:Z,onClose:S,userId:e.user.id,basket:f,price:k,cb:function(){return W.apply(this,arguments)}})]})})),k=v},9731:function(e,n,t){var r,s=t(4569),c=t.n(s)().create({baseURL:"https://mydiplomlevas.herokuapp.com/api/",headers:{Authorization:null!==(r=localStorage.getItem("Token"))&&void 0!==r?r:""}});c.interceptors.response.use((function(e){return e}),(function(e){return 401===e.response.status&&localStorage.removeItem("Token"),Promise.reject(e)})),n.Z=c}}]);
//# sourceMappingURL=926.9809860d.chunk.js.map